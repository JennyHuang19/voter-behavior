---
title: "Final Written Report: What makes someone more likely to vote?"
author: "Approximately Normal: Jenny Huang, Bella Larsen, Jessie Bierschenk, Aidan Gildea"
date: "17 November 2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE, 
                      message = FALSE)
```

```{r load-packages, message=FALSE}
library(tidyverse)
library(broom)
library(patchwork)
library(RColorBrewer)
library(ggthemes)
library(viridis)
library(skimr)
```

```{r data}
elections <- read_csv("data/data_full.csv")
```

```{r data cleaning}
elections_clean <- elections %>% 
  mutate(metro = if_else(METRO == 2, "Metro", "Not Metro/Unknown")) %>% 
  mutate(sex = case_when(SEX == 1 ~ "Male",
                         SEX == 2 ~ "Female")) %>% 
  mutate(marst = case_when(MARST == 1 ~ "Married",
                           MARST == 2 ~ "Married",
                           MARST == 4 ~ "Divorced/Separated",
                           MARST == 3 ~ "Divorced/Separated",
                           TRUE ~ "Not Married/Other")) %>% 
  mutate(veteran = if_else(VETSTAT == 2, "Yes", "No/Uknnown")) %>% 
  mutate(citizen = case_when(CITIZEN == 5 | CITIZEN == 9 ~ "No/Unknown", 
                             CITIZEN == 1 | CITIZEN == 2 | CITIZEN == 3 ~ 
                               "Native Born",
                             CITIZEN == 4 ~ "Naturalized")) %>% 
  #There are no observations with 5 or 9 for citizen
  mutate(hispanic_status = if_else(HISPAN == 0 | HISPAN == 901 | HISPAN == 902, 
                             "Not Hispanic/Unknown", "Hispanic/Latinx")) %>% 
  mutate(employed = if_else(LABFORCE == 2, "Yes", "No/Unknown")) %>% 
  mutate(highest_education = case_when(EDUC99 == 0 | EDUC99 == 1 ~ 
                                         "None/Unknown",
                               EDUC99 == 4 | EDUC99 == 5 | EDUC99 == 6 |
                                 EDUC99 == 7 | EDUC99 == 8 | EDUC99 == 9
                               ~ "Some High School",
                               EDUC99 == 10 ~ "High School Degree/GED",
                               EDUC99 == 11 ~ "Some College",
                               EDUC99 == 12 | EDUC99 == 13 | EDUC99 == 14
                               ~ "Associate Degree",
                               EDUC99 == 15 ~ "Bachelors Degree",
                               EDUC99 == 16 ~ "Masters Degree",
                               EDUC99 == 17 ~ "Professional Degree",
                               EDUC99 == 18 ~ "Doctorate Degree")) %>% 
  mutate(current_student = case_when(SCHLCOLL == 5 | SCHLCOLL == 0 ~ 
                                       "Not currently enrolled",
                                     SCHLCOLL == 1  ~ "High School Full Time",
                                     SCHLCOLL == 2 ~ "High School Part Time",
                                     SCHLCOLL == 3 ~ "College Full Time",
                                     SCHLCOLL == 4 ~ "College Part Time")) %>% 
#of people 16-24
  mutate(race = case_when(RACE == 820 | RACE == 830 | RACE == 830 | RACE == 819 
                          | RACE == 804 | RACE == 805 | RACE == 806 | 
                            RACE == 807 | RACE == 808 | RACE == 810 | 
                            RACE == 811 | RACE == 812 | RACE == 813 | 
                            RACE == 814 | RACE == 815 | RACE == 816 | 
                            RACE == 817 | RACE == 818 | RACE == 803 | 
                            RACE == 801 | RACE == 802 | RACE == 830 ~ 
                            "2 or more races",
                          RACE == 100 ~ "White",
                          RACE == 200 ~ "Black",
                          RACE == 651 | RACE == 809 | RACE == 652 | RACE == 650
                          ~ "Asian or Pacific Islander",
                          RACE ==  300 ~ "Native American",
                          RACE == 999 | RACE == 700 ~ "Other/Unknown")) %>% 
  #Need to go over these race categorizations as a group!
  mutate(why_not_vote = case_when(VOWHYNOT == 10 ~ "Inconvenience",
                                  VOWHYNOT == 4 ~ "Interest",
                                  VOWHYNOT == 7 ~ "Political",
                                  VOWHYNOT == 9 | VOWHYNOT ==  6 | 
                                    VOWHYNOT == 5 | VOWHYNOT == 2 ~ 
                                    "Logistical",
                                  VOWHYNOT == 1 ~ "Physically Unable",
                                  VOWHYNOT == 8 ~ "Registration Issues",
                                  VOWHYNOT == 3 ~ "Forgot")) %>% 
#Reason why eligible voter did not vote
  mutate(why_not_reg = case_when(VOYNOTREG == 8 | VOYNOTREG == 3 ~ 
                                   "Not Eligible",
                                 VOYNOTREG == 7 | VOYNOTREG == 6 ~ 
                                   "Not Interested/Vote Won't Matter",
                                 VOYNOTREG == 5 ~ "Language Barrier",
                                 VOYNOTREG == 4 ~ "Physically Unable",
                                 VOYNOTREG == 2 | VOYNOTREG == 1 ~ 
                                   "Lacked Info/Missed Deadline")) %>% 
  mutate(voting_method = case_when(VOTEHOW == 1 ~ "In Person",
                                   VOTEHOW == 2 ~ "Mail-In")) %>% 
  mutate(voting_time = case_when(VOTEWHEN == 2 ~ "Early",
                                 VOTEWHEN == 1 ~"Voting Day")) %>% 
  mutate(voted = case_when(VOTED == 1 ~ 0,
                           VOTED == 2 ~ 1)) %>% 
  mutate(registered = case_when(VOREG == 1 ~ 0,
                           VOREG == 2 ~ 1)) %>% 
  mutate(how_registered = case_when(VOREGHOW == 8 ~ "Online",
                                    VOREGHOW == 7 ~ "Polling Place",
                                    VOREGHOW == 6 ~ "Registration Drive",
                                    VOREGHOW == 5 | VOREGHOW == 2 | 
                                      VOREGHOW == 1 ~ 
                                      "Govt Office/Public Agency",
                                    VOREGHOW == 4 ~ "School/College/Hospital",
                                    VOREGHOW == 3 ~ "By Mail")) %>% 
  mutate(Presidential_Election_Status = case_when(YEAR %in% c(2004, 2008, 
                                                          2012, 2016) ~ 
                                                    "Presidential",
                                                  YEAR %in% c(2006, 2014) ~ 
                                       "Midterm Following Incumbent President",
                                          YEAR %in% c(2010, 2018) ~ 
                                          "Midterm Following New President"),
         Presidential_Election_Status = factor(Presidential_Election_Status)) %>% 
    mutate(Is_Presidential_Election = case_when(YEAR %in% c(2004, 2008, 
                                                          2012, 2016) ~ 
                                                    "Presidential",
                                                  YEAR %in% c(2006, 2010, 2014, 
                                                              2018) ~ 
                                       "Non-Presidential"),
         Is_Presidential_Election = factor(Is_Presidential_Election)) %>% 
  select(metro, sex, marst, veteran, citizen, hispanic_status, employed, 
         highest_education, current_student, race, why_not_vote, why_not_reg,
         voting_method, voting_time, voted, registered, how_registered, YEAR,
         STATEFIP, AGE, Presidential_Election_Status, Is_Presidential_Election)

elections_clean <- elections_clean %>% 
  mutate(metro = factor(metro),
         sex = factor (sex),
         marst = factor(marst),
         veteran = factor(veteran),
         citizen = factor(citizen),
         hispanic_status = factor( hispanic_status),
         employed = factor(employed),
         highest_education = factor(highest_education),
         current_student = factor(current_student),
         race = factor(race),
         why_not_vote = factor(why_not_vote),
         why_not_reg = factor(why_not_reg),
         voting_method = factor(voting_method),
         voting_time = factor(voting_time),
         voted = factor(voted),
         registered = factor(registered),
         how_registered = factor(how_registered))

```

```{r relevel-factors}
elections_clean <- elections_clean %>% 
  mutate(marst = fct_relevel(marst, c("Married", "Divorced/Separated", 
                                      "Not Married/Other")),
         citizen = fct_relevel(citizen, c("Native Born", "Naturalized", 
                                      "No/Unknown")),
         highest_education = fct_relevel(highest_education, 
                                         c("Bachelors Degree", 
                                           "High School Degree/GED",
                                           "Some College",
                                           "Some High School", 
                                           "Associate Degree",
                                           "Masters Degree",
                                           "Professional Degree",
                                           "Doctorate Degree",
                                           "None/Unknown")),
         current_student = fct_relevel(current_student, 
                                       c("Not currently enrolled",
                                         "High School Full Time", 
                                         "High School Part Time",
                                         "College Full Time", 
                                         "College Part Time")),
         race = fct_relevel(race, c("White","Black","Asian or Pacific Islander", 
                                    "Native American", "2 or more races", 
                                    "Other/Unknown")),
         Presidential_Election_Status = fct_relevel(Presidential_Election_Status, 
                    c("Presidential", "Midterm Following Incumbent President", 
                                      "Midterm Following New President")))
```

# Introduction and Data

  In our regression analysis, we will be assuming the role of a nonprofit political organization aiming to design the most effective GOTV ("get out the vote") effort possible. Our primary focus is to increase voter turnout, however, as an organization funded solely by donations, we need to make sure our outreach efforts are as financially efficient as possible. Therefore, it is critical that we are sending our mailing literature primarily to those we believe may not vote -- as this will help turnout voters who may not of voted otherwise. To do so, we will conduct a regression analysis that investigates the different factors and characteristics that appear to be involved or related to voters in the U.S. We are using data on voting behaviors in the U.S. over the past 14 years [1]. These data are sourced from IPUMS (an organization that provides census and survey data) and the American Statistical Association (ASA) [2, 1]. These data include 28 variables on more than 640,000 voters in the U.S. The data collected contains voter characteristics such as age, geographic location, sex, race, marital status, employment, citizenship, ethnicity, education, and voting history and tendencies [1]. This information is particularly relevant in exploring what factors may be related to U.S. - Americans voting or not.

  Motivation for our research comes from previous efforts to predict voting behaviors. In an MIT Election data study, researchers describe how understanding voter turnout is important when observing the particular tendencies of certain groups of people as well as factors that motivate individual U.S. citizens to vote [3]. The study highlights general assumptions of voter turnout predictions, noting how higher turnout rates tend to be related to individuals with the following traits: married, white, female, higher education, higher income, older age [3]. The article also addresses how reform may be able to increase voter turnout [3]. In another study done by Harvard graduate student Anthony George Fowler, voter turnout and its implications and repercussions are further examined in the U.S. as well as Australia and Mexico [4]. The study explores the 2008 U.S. election and addresses partisan gaps, voter knowledge (how politically-informed a voter is), and race as main variables of interest in exploring voter tendencies in the U.S. [4]. Both of these studies provide motivation for further and continued investigation into voter data and statistics -- especially for our efforts to understand what populations usually do not make it to the voting booth.

  In anticipation of our GOTV effort, we are interested in predicting whether a person voted or not based on a list of predictor variables including sex, age, marital status, veteran status, citizenship status (native born or naturalized citizen), whether or not someone is Hispanic or Latinx, employment status and more (described in more detail in Section 2). Our proposed research question is: do voter turnout rates depend on these predictors? Which predictors are more impactful than others? We are also interested in looking at voter turnout over time. We will use the predictor (year) to see if there are changes in voter turnout by demographics over time, or perhaps compare models from different time periods to determine how voter trends have changed over time. Our organization's initial hypothesis is that the significant predictors of voter turnout will include age, level of education, whether they voted in previous elections, and race. Based on historical patterns, people in older age categories tended to vote more than people in younger age categories and people with higher levels of education tended to vote more frequently than people with lower levels of education [5]. Finally, if a person has voted previously, we predict they will be more likely to vote again compared to someone who has not voted previously. Taking these hypotheses into consideration, we will explore which factors are most significant in relation to voting attendance. Our findings will hopefully allow us to identify populations that are statistically less likely to vote, informing who we target with our GOTV literature in the future. 

  While our GOTV initiative hopes to turnout people who we determine are unlikely to vote, our statistical analysis will use a broad margin to determine who should receive our informational materials. Every vote matters, so we want to make sure no one gets left behind!  
We will begin our EDA by visualizing the relationship between the response variable describing whether or not someone voted and several of the other variables of particular interest.

First, we will simply look at the distribution of those who voted throughout the last 8 years of elections.


```{r EDA, fig.height=3, fig.width=5}
response_plot <- ggplot(data = elections_clean, aes(x = voted, 
                                                    fill = "gainsboro")) +
  geom_bar() +
  theme_bw() +
  # see theme code inspiration at reference 1 
  theme(plot.title= element_text(face="bold", color = "Navy Blue"),
        plot.subtitle = element_text(face = 4, color = "grey54"),
        panel.grid.major = element_line(color = "Navy Blue", size=.1),
        legend.position = "none") +
  # see scale fill code inspiration at reference 2
  scale_fill_manual(values = c("gainsboro")) +
  labs(title = "Visualizing the Distribution of Voting Status", y = "Count",
       x = "Voted", subtitle = "More people reportedly voted than did not vote",
       caption = "0 = Did not Vote, 1 = Voted")
response_plot
```

*see theme code inspiration at reference [6]*
*see scale fill code inspiration at reference [7]*

From the barplot above, it is clear the more individuals in the data set voted (voted = 1) than did not (voted = 0).

Many political nonprofits engage with college campuses, so we want to analyze whether or not being a student influences the frequency of voting. We will explore this preliminarily by visualizing the distribution of if school aged individuals (18-24) voted or not -- categorized by their current student level. This is seen in the bar plot below.

```{r EDA1, fig.height=3, fig.width=5}
EDA1 <- elections_clean %>% 
  ggplot(aes(x = voted, fill = current_student)) +
  geom_bar() +
  theme_bw() +
  theme(plot.title= element_text(face="bold", color = "Navy Blue"),
        plot.subtitle = element_text(face = 4, color = "grey54"),
        panel.grid.major = element_line(color = "Navy Blue", size=.1))+
  #see scale fill brewer code inspiration from reference 1
  scale_fill_brewer(palette = "Blues") +
  labs(title = "Voting Distribution of 16-24 Year Olds", 
       y = "Count", x = "Voted", 
       subtitle = "Examining relationship between student status and voting",
       caption = "0 = Did not Vote, 1 = Voted",
       fill = "Current Student Status")
EDA1
```

*see scale fill brewer code inspiration from reference [6]*

From the bar plot, it is evident that a majority of these individuals were not currently enrolled. This may be a result of a general national trend, but we want to investigate if it is the result of a larger proportion of older individuals within in the range of ages between 16-24. We will investigate this by analyzing those who are not currently enrolled in school within this age range.

```{r age-distribution-college-aged}
elections_clean %>%
  filter(current_student == "Not currently enrolled") %>%
  filter(AGE >=16 & AGE <=24) %>%
  group_by(AGE) %>%
  count()  %>% 
  ungroup() %>%
  mutate(prop = n/sum(n)) %>%
  kable(digits = 3, 
  caption = "Proportion of Respondents Not Currently Enrolled In School By Age")
```

From the table above, it is apparent that more than 40% of those not currently enrolled in school are 23-24 years old. This could be a potential reason for why this age range includes so many who are not currently enrolled as a student. 

To more meaningfully analyze the relationship between being a student and if they vote or not, we adjusted our visualization to only include those currently enrolled in some level of education. This is seen in the visualization below. 

```{r EDA2, fig.height=3, fig.width=5}
EDA2 <- elections_clean %>% 
  filter(current_student != "Not currently enrolled") %>% 
  ggplot(aes(x = voted, fill = current_student)) +
  geom_bar() +
  theme_bw() +
    theme(plot.title= element_text(face="bold", color = "Navy Blue"),
        plot.subtitle = element_text(face = 4, color = "grey54"),
        panel.grid.major = element_line(color = "Navy Blue", size=.1))+
  scale_fill_brewer(palette="Blues") +
  labs(title = "Voting Distribution of 16-24 Year Olds \nEnrolled in School", 
       y = "Count", x = "Voted", 
       subtitle = "Examining relationship between student status and voting",
       caption = "0 = Did not Vote, 1 = Voted",
       fill = "Current Student Status")
EDA2
```

This visualization shows that eligible voters between the age 16-24 enrolled in some education at the time were mainly full time college students. More full time and part time college students that were eligible to vote did vote compared to those that did not vote. The opposite is true for high school students: more full time and part time high school students that were eligible to vote did not vote compared to those that did vote. 

```{r EDA3, fig.height=3, fig.width=5}
citizen_plot <- elections_clean %>% 
  group_by(citizen) %>% 
  count(voted) %>% 
  mutate(total = sum(n)) %>% 
  mutate(prop = n/total) %>% 
  mutate(prop = round(prop, 3))
citizen_plot %>% 
  ggplot(aes(x = voted, y = prop, fill = citizen)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = prop), vjust = 0.5) + 
  #see geom_text() code inspiration in reference [4]*
  facet_grid(cols = vars(citizen))+
  scale_fill_brewer(palette = "Blues") +
  labs(title = "Voting distribution based on citizenship status", 
       y = "Proportion", x = "Voted", 
     subtitle = "Examining relationship between citizenship status and voting",
       caption = "0 = Did not Vote, 1 = Voted",
       fill = "Citizenship Status") +
  theme_bw()
```

*see geom_text() code inspiration in reference [8]*

This visualization shows that for both native born and naturalized individuals, more citizens that were eligible to vote did vote compared to those that did not vote; however, the proportion is much greater for native born citizens than for naturalized. For a similar plot comparing respondents by veteran status, please consult Appendix A.

```{r EDA4, fig.height=3, fig.width=5}
elections_clean %>% 
  ggplot(aes(x = AGE, y = voted)) +
  geom_boxplot(fill = "gray") +
  coord_flip() +
  labs(title = "Relationship between age and voting", 
       y = "Voting Status", x = "Age", 
       caption = "0 = Did not Vote, 1 = Voted",
       fill = "Citizenship Status")+
  theme_bw()

```

This box plot shows that eligible voters that did vote were generally older than eligible voters that did not vote.

We are also interested in looking at how voter turnout has changed over the
years.

```{r year-voting-frequency}
elections_year <- elections_clean %>% 
  group_by(YEAR) %>% 
  count(voted) %>% 
  mutate(prop_voted = n/sum(n))
```

We notice that the proportion of people who voted fluctuates depending on
whether the year falls on a presidential election. In the trend of the 
proportion of voting over time, we see a clear divide between the years when
there is a presidential elections versus when there is not. In the future, we 
may decide to add the variable "Election Year" as an interaction term with year
as a divide between years that fall on an election.

```{r EDA6, fig.height=3, fig.width=4.5}
elections_year %>% 
  filter(voted == 1) %>% 
  ggplot(aes(x = YEAR, y = prop_voted)) +
  geom_point() +
  labs(title = "Visualizing Proportion of Voters Over Time", 
       y = "Proportion of People Who Voted", x = "Year")
```

We decided to look at the scatterplot of voter turnout over time broken down by the status of the election (Presidential election, midterm after incumbent president, or midterm after new president) to see how it may differ depending on the election.

```{r scatterplot-over-time, fig.height=3, fig.width=6}
elections_year %>% 
  mutate(Presidential_Election_Status = case_when(YEAR %in% c(2004, 2008, 
                                                          2012, 2016) ~ 
                                                    "Presidential",
                                                  YEAR %in% c(2006, 2014) ~ 
                                       "Midterm Following Incumbent President",
                                          YEAR %in% c(2010, 2018) ~ 
                                          "Midterm Following New President"),
        Presidential_Election_Status = factor(Presidential_Election_Status)) %>% 
  filter(voted == 1) %>% 
  ggplot(aes(x = YEAR, y = prop_voted, color = Presidential_Election_Status)) +
  geom_point() +
  labs(title = "Higher Proportion of Voters During Presidential Election Years", 
       y = "Proportion of People Who Voted", x = "Year", 
       color = "Presidential Election Year", caption = "1: Yes; 0: No")
```

From the above scatterplot, we confirmed that there is higher voter turnout during presidential elections compared to midterm elections. In addition, there is equal or higher voter turnout for midterm elections following the election of a new president compared to midterm elections following the election of an incumbent president, and an especially high voter turnout in the midterm election after Trump's election in 2016.

Finally, it is important to acknowledge that our any missingness in our data, as it may influence the outcome of our regression analysis. The initial data sourced from the This Is Statistics: Fall Data Challenge used non-uniform values for the different variables, therefore we cleaned the data to be more intelligible for our analysis. While cleaning, we did impute "NA" values by either combining them with other categories and/or removing them to improve our analysis. We believe this will not negatively affect out analysis, yet will move forward taking it into consideration. 

After analyzing these preliminary visualizations and observations, we will now begin to build our model. 

# Methodology

## Model Selection 

**Select a random subset of the data to create model.**

In order to make our model, we have decided to take a random sample of 10,000 to be sure that the model selection is accurate and not obscured by too many observations. 

```{r random-sample, message = FALSE}
set.seed(6687) 
elections_red <- elections_clean %>%
  sample_n(10000)
```

Using the random sample of 10,000 observations, we began the model selection process. See Appendix B for the full backward selection model output.

```{r backward-selection, include=FALSE}
int_only_model <- glm(voted ~ 1,
                     data = elections_red,
                      family = "binomial")

full_model <- glm(voted ~ metro + sex + marst + veteran+ citizen + 
                   hispanic_status + employed + highest_education + 
                   current_student + race + AGE + Presidential_Election_Status
                 + YEAR,
                     data = elections_red,
                      family = "binomial")

best_model <- step(full_model, scope=formula(int_only_model), 
                   direction = "backward")

```

```{r tidy model}
tidy(best_model) %>% 
  kable(digits = 3, caption = "Model Resulting From Backward Selection")
```

The final model included YEAR + sex + current_student + citizen + employed + race + 
marst + Presidential_Election_Status + AGE + highest_education. 

The final model is: 


The backward selection based on AIC took out the variables metro, veteran, and hispanic_status (see Appendix B).

Interpretation of coefficients of interest:

Baseline: Female, married, native born, not employed, Bachelors Degree is highest education, not currently enrolled in school if between the age of 16-24, White, and the time of voting is midterm following the election of an incumbent president.


We expect the odds of an eligible voter voting for a divorced/separated eligible voter to be 0.50 (exp(-0.702)) times the odds of individuals that are female, married, native born, not employed, have Bachelors Degree as their highest education,  not currently enrolled in school if between the age of 16-24, White, and the election is a midterm election following the election of an incumbent president, after factoring in all other voter characteristics/information. 

For each additional year in age, we expect the odds of an eligible voter voting  to be 1.04 (exp(0.040)) times the odds of individuals that are female, married, native born, not employed, have Bachelors Degree as their highest education,  not currently enrolled in school if between the age of 16-24, White, and the election is a midterm election following the election of an incumbent president, after factoring in all other voter characteristics/information. 

We expect the odds of an eligible voter voting when it is a presidential election year to be 2.689 (exp(0.989)) times the odds of individuals that are female, married, native born, not employed, have Bachelors Degree as their highest education,  not currently enrolled in school if between the age of 16-24, White, and the election is a midterm election following the election of an incumbent president, after factoring in all other voter characteristics/information. 

## Checking Model Conditions

**Linearity**

```{r model-conditions-1, include=FALSE}
elections_red %>%
  count(sex, voted) %>%
  group_by(sex) %>%
  mutate(prop = n/sum(n)) %>%
  filter(voted == "1") %>%
  mutate(emp_logit = log(prop/(1-prop))) %>% 
  kable()

elections_red %>%
  count(marst, voted) %>%
  group_by(marst) %>%
  mutate(prop = n/sum(n)) %>%
  filter(voted == "1") %>%
  mutate(emp_logit = log(prop/(1-prop))) %>% 
  kable()
```

According to the empirical logit plot (see Appendix C), there is a linear relationship between the empirical logit and the predictor variable age. Hence linearity is satisfied 
for AGE.

```{r logit, fig.height=4, fig.width=6, include=FALSE}
library(Stat2Data)
emplogitplot1(voted ~ AGE, data = elections_red, 
              ngroups = 10)
```

**Randomness**

It is possible that randomness is not satisfied because our data is
from the census survey, which may not be random (ie might select for people who
have time to fill it out). However, there is no reason to believe that this will not generalize to the US population as a whole in a significant way, particularly due to the large sample size.

**Independence**

Independence may be violated because geographic location may influence voting due to factors such as (residuals by state ID). Hence, we will look at misclassification rate by region.

```{r fip-new, include=FALSE}
library(maps)
data(state.fips)
joined_fips <- left_join(elections_red, state.fips, by = c("STATEFIP" = "fips"))
```

```{r augment, include=FALSE}
model_aug <- augment(best_model, type.predict = "response") #probability
```

Here, we create a confusion matrix with a decision threshold of 0.5.

```{r predicted}
model_aug <- model_aug %>% 
  mutate(predicted_voted = if_else(.fitted > 0.5, "Will Vote", "Will Not Vote"))
```

We will join the augmented data with region in order to look at misclassification rates by region.

```{r join}
tojoin <- joined_fips %>% 
  select(AGE, region)

aug_fips <- left_join(model_aug, tojoin, by ="AGE")
```

Below is a table of the misclassification rates by region.

```{r misclassification-rates-by-region}
aug_fips <- aug_fips %>% 
  mutate(region = case_when(region == 1 ~ "Northeast",
                            region == 2 ~ "Midwest",
                            region == 3 ~ "South",
                            region == 4 ~ "West"))
# used Census data for the region fips number corresponding to region name [3]

missclassification <- aug_fips %>% 
  group_by(region) %>% 
  count(voted, predicted_voted) %>%  
  #all combs of responses specified as arguments
  mutate(prop = n / sum(n)) %>% 
  filter(voted == 1 & predicted_voted == "Will Not Vote" | 
        voted == 0 & predicted_voted == "Will Vote")
missclassification %>% 
  kable(digits = 3, caption = "Missclassification Rates by Region")
```

*Consulted Census data for the region fips number corresponding to region name [9]*

We then created a plot of misclassification rate by region to determine if 
independence is satisfied. See the Appendix C for the boxplot visualizing the misclassification rates by region.

```{r boxplot-misclassification, include=FALSE}
aug_fips %>% 
  group_by(region) %>% 
  count(voted, predicted_voted) %>% 
  #all combs of responses specified as arguments
  ggplot(aes(x = predicted_voted, y = n, color = region)) +
  geom_boxplot()
```

Based on the misclassification rates, we have no reason to believe that the independence condition is not satisfied. The misclassification rates across regions are relatively similar, which suggests that there is not an issue of spatial correlation and that the independence condition is satisfied.

## Checking for influential points

```{r obs-num, include=FALSE}
best_aug <- augment(best_model) %>%
   mutate(obs_num = row_number()) #add row number to help with graphing
```

**Cook's distance**

We will also look for influential points using Cook's Distance. See the plot for Cook's distance in Appendix C. 

```{r Cooks-D, fig.height=3, fig.width=6, include=FALSE}
## scatterplot of Cook's D vs. observation number
ggplot(data = best_aug, aes(x = obs_num, y = .cooksd)) +
  geom_point(alpha = 0.7) +
  geom_hline(yintercept = c(0.5,1), color = "red", lty = 2) +
  labs(x = "Observation Number", y = "Cook's D") +
  geom_text(aes(label = ifelse(.hat > 0.5,
                           as.character(obs_num), "")), nudge_x = 1)
```

According to the plot of Cook's Distance (see Appendix C), there are no influential points, so all points can be left in the model.

**Multicollinearity**

```{r VIF, include=FALSE}
# load rms package and calculate VIF
library(rms)
vif(best_model) %>% 
  tidy() %>% 
  arrange(x) %>% 
  kable(digits = 3)
```

All of the VIF values are under the threshold of 10 (see table in Appendix C), indicating that there is no evidence of multicollinearity in our data.


## Interaction Terms

We will add in several interaction terms of interest to us and use a drop-in-deviance test to see if they are meaningful predictors of the odds of someone voting.

The reduced model is the same as the above model titled "Model Resulting From Backward Selection," and the full model is the reduced model plus interactions terms for sex and employment, presidential election status and highest education level, age and presidential election status, sex and presidential election status, and race and presidential election status.

The following hypotheses will be used:

$H_0$: the coefficients for the interaction between sex and employment, presidential election status and highest education level, age and presidential election status, sex and presidential election status, and race and presidential election status are all zero

$H_0:$

$\beta_{sex*employed} = \beta_{Presidential-Election-Status*highest_education} = \beta_{AGE*Presidential-Election-Status} = \beta_{sex*Presidential-Election-Status} = \beta_{race*Presidential-Election-Status} = 0$

$H_a$: at least one of these coefficients for the interaction terms $\neq$ zero

$\alpha = 0.05$

```{r interaction}
reduced_model <- best_model

full_model <- glm(voted ~ YEAR + sex + current_student + citizen + employed + 
                    race + marst + Presidential_Election_Status + AGE + 
                    highest_education +
                    Presidential_Election_Status*highest_education + 
                    AGE*Presidential_Election_Status + 
                    sex*Presidential_Election_Status + 
                    race*Presidential_Election_Status,
                     data = elections_red,
                      family = "binomial")
```

```{r drop-in-deviance1}
anova(reduced_model, full_model, test = "Chisq") %>%
  tidy() %>% 
  kable(digits = 3, 
        caption = "Drop-In-Deviance Test Results For Interaction Terms")
```

The p-value (7.840e-07) is very small (less than the alpha level 0.05), 
so we can reject the null hypothesis. Thus, we conclude that the data provide 
sufficient evidence that the coefficients associated with the additional 
interaction terms are not equal to 0. Therefore, we should add them to the model.

Significant interaction terms:
The effect of the election being a presidential election for an individual with
the highest level of education as a High School Degree/GED is significant with
a p-value of 0.011 assuming an alpha level of 0.05. The coefficient is negative,
indicating that this effect would mean that during a presidential election for
an individual with the highest level of education as a High School Degree/GED,
they are less likely to vote than individuals that are female, married, native
born, not employed, have Bachelors Degree as their highest education, 
not currently enrolled in school if between the age of 16-24, White, and 
the election is a midterm election following the election of an incumbent 
president.

The effect of the election being a presidential election for an individual that
is Black is significant with a p-value of 0.013 assuming an alpha level of 0.05.
The coefficient is positive, indicating that this effect would mean that during
a presidential election for an individual that is Black, they are more likely to
vote than individuals that are female, married, native born, not employed, have
Bachelors Degree as their highest education,  not currently enrolled in school
if between the age of 16-24, White, and the election is a midterm election
following the election of an incumbent president


```{r resulting-model}
reduced_model <- best_model

full_model <- glm(voted ~ YEAR + sex + current_student + citizen + employed + 
                    race + marst + Is_Presidential_Election + AGE + 
                    highest_education +
                    Presidential_Election_Status*highest_education + 
                    AGE*Presidential_Election_Status + 
                    sex*Presidential_Election_Status + 
                    race*Presidential_Election_Status,
                     data = elections_red,
                      family = "binomial")
```

We will use a drop-in-deviance test to determine whether or not sex is a 
meaningful predictor of the odds of someone voting.

The following hypotheses will be used:

$H_0$: the coefficients for the main effect for sex, the interaction between sex and employment, and sex and presidential election status are all zero. All of the coefficients associated with sex are equal to zero.

$H_0:$ $\beta_{sex} =\beta_{sex*employed} = \beta_{sex*Presidential-Election-Status} = 0$
$H_a$: at least one of these coefficients for the coefficients associated with sex $\neq$ zero

$\alpha = 0.05$

```{r model-with-sex}
sex_included <- glm(voted ~ YEAR + sex + current_student + citizen + employed + 
                    race + marst + Is_Presidential_Election + AGE + 
                    highest_education +
                    Presidential_Election_Status*highest_education + 
                    AGE*Presidential_Election_Status + 
                    sex*Presidential_Election_Status + 
                    race*Presidential_Election_Status,
                     data = elections_red,
                      family = "binomial")

sex_excluded <- glm(voted ~ YEAR + current_student + citizen + employed + 
                    race + marst + Is_Presidential_Election + AGE + 
                    highest_education +
                    Presidential_Election_Status*highest_education + 
                    AGE*Presidential_Election_Status + 
                    race*Presidential_Election_Status,
                     data = elections_red,
                      family = "binomial")
```


```{r drop-in-deviance2}
anova(sex_excluded, sex_included, test = "Chisq") %>%
  tidy() %>% 
  kable(digits = 3, caption = "Drop-In-Deviance Test Results For Sex")
```

From the drop-in-deviance test to include variable sex, the p-value (0.267) is greater than an alpha-level of 0.10, so we will exclude the main effect for sex and the interaction terms including sex from the model. This contradicts the model output from the backward selection, which is most likely due their different criteria for statistical significance. Backward selection makes decisions based on the AIC, while the drop-in-deviance test uses the p-value. A potential discrepancy between the two values may have resulted in the different determinations of the significance of sex. We have chosen to use the results of the drop-in-deviance test, and therefore, will be excluding sex from the final model.

# Results

```{r final-voting-model}
voting_model <- sex_excluded

tidy(voting_model) %>%
  kable(digits=3, caption = "Final Model Output")
```

## Checking Model Conditions for Final Model

### Checking for influential points

```{r obs-num-final}
final_best_aug <- augment(voting_model) %>%
   mutate(obs_num = row_number()) #add row number to help with graphing
```

**Cook's distance**

We will also look for influential points in our final model using Cook's Distance.

```{r Cooks-final, fig.height=3, fig.width=6, include=FALSE}
## scatterplot of Cook's D vs. observation number
ggplot(data = final_best_aug, aes(x = obs_num, y = .cooksd)) +
  geom_point(alpha = 0.7) +
  geom_hline(yintercept = c(0.5,1), color = "red", lty = 2) +
  labs(x = "Observation Number", y = "Cook's D") +
  geom_text(aes(label = ifelse(.hat > 0.5,
                           as.character(obs_num), "")), nudge_x = 1)
```

According to the Cook's Distance plot for the final model (see Appendix D), there are no influential points, so all points can be left in the final model.

**Multicollinearity**

```{r VIF-final, include=FALSE}
# load rms package and calculate VIF
library(rms)
vif(voting_model) %>% 
  tidy() %>% 
  arrange(x) %>% 
  kable(digits = 3)
```

All of the VIF values are under the threshold of 10 (see Appendix D), indicating that there is no evidence of multicollinearity in our final model.

## Creating Classifier

We'll fit an ROC curve to help us determine a decision-making threshold. 

```{r augment-for-roc}
voting_aug <- augment(voting_model, type.predict = "response") %>%
  mutate(voted = fct_relevel(voted, c("1", "0")))
```

```{r calculate-threshold-levels}
library(broom)
library(yardstick)

# calculate sensitivity and specificity at each threshold
roc_curve_data <- voting_aug %>%
  roc_curve(voted, .fitted) %>%
  mutate(pred_prob = exp(.threshold)/(1 + exp(.threshold)))
```

```{r roc-curve-plot, fig.height=5, fig.width=3}
autoplot(roc_curve_data)
```

Below we look at values within a range of thresholds in order to choose the 
threshold that yields high sensitivity and low values of (1 - specificity).

```{r roc-curve-threshold}
roc_curve_data %>%
  filter(.threshold > .419, .threshold < .42) %>% 
  kable(digits = 3, caption = "ROC Curve Threshold Table")
```

According to our ROC curve and modeling objectives, we will choose a threshold
of .42 because we want to lean towards having a higher false negative rate
(type II error) than a false positive rate as it does not hurt to mail a
few extra ballots to people who may already be planning to vote.

Any data point with a probability over 0.60 will be predicted to be in
the "voted" category.


# Discussion 

While completing this project provided excellent insight into the voting patterns in the United States, there are several limitations of this project that must be acknowledged. First, the original dataset hard-coded several variables with "unknown" and "missing" combined into one category. This could have obscured the effects of missingness in our data and contributed to decreasing the predictive accuracy of our model and results. For this reason, if given the opportunity to expand this project, we would like to explore missingness in our dataset and its implications with more depth to improve our model. Because several categorical variables already had levels that combined missing and unknown, we decided to code the other variables in the same way, effectively imputing a new category for missing that was used in the model. While this was the best way to deal with missingness within the scope of this project, we would be interested in expanding this in the future and teasing out missing from unknown to create a more accurate model and improve our results.

\newpage

# References

[1]“Fall Data Challenge | This Is Statistics.” n.d. Accessed November 16, 2020. https://thisisstatistics.org/falldatachallenge/.

[2] University of Minnesota. “What Is IPUMS?” Text. IPUMS. February 7, 2019. https://ipums.org/what-is-ipums.

[3] MIT Election Data + Science Lab. n.d. “Voter Turnout.” Accessed November 16, 2020. https://plotly.com/~cwimpy/69/.

[4] Fowler, Anthony George. 2013. “Five Studies on the Causes and Consequences of Voter Turnout,” October. https://dash.harvard.edu/handle/1/11156810.

[5] McDonald, Michael. n.d. “Voter Turnout Demographics - United States Elections Project.” Accessed November 16, 2020. http://www.electproject.org/home/voter-turnout/demographics.

[6] “GGPlot Cheat Sheet for Great Customization - Articles - STHDA.” http://www.sthda.com/english/articles/32-r-graphics-essentials/125-ggplot-cheat-sheet-for-great-customization/ (November 15, 2020).

[7] “The A - Z Of Rcolorbrewer Palette You Must Know.” 2018. Datanovia. https://www.datanovia.com/en/blog/the-a-z-of-rcolorbrewer-palette/ (November 15, 2020).

[8] “How to Put Labels over Geom_bar for Each Bar in R with Ggplot2.” Stack Overflow. https://stackoverflow.com/questions/12018499/how-to-put-labels-over-geom-bar-for-each-bar-in-r-with-ggplot2 (November 15, 2020).

[9] Prepared by the Geography Division of the U.S. Census Bureau. “Census Regions and Divisions of the United States.” https://www2.census.gov/geo/pdfs/maps-data/maps/reference/us_regdiv.pdf.

\newpage

# Appendix A

```{r EDA5, fig.height=4.3, fig.width=6}
veteran_plot <- elections_clean %>% 
  group_by(veteran) %>% 
  count(voted) %>% 
  mutate(total = sum(n)) %>% 
  mutate(prop = n/total) %>% 
  mutate(prop = round(prop, 3))
veteran_plot %>% 
  ggplot(aes(x = voted, y = prop, fill = veteran)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = prop), vjust = -0.05) +
  #see geom_text() code inspiration in reference [4]*
  facet_grid(cols = vars(veteran))+
  scale_fill_brewer(palette = "Blues") +
  labs(title = "Voting distribution based on veteran status", 
       y = "Proportion", x = "Voted", 
     subtitle = "Examining relationship between veteran status and voting",
       caption = "0 = Did not Vote, 1 = Voted",
       fill = "Veteran Status") +
  theme_bw()
```

*see geom_text() code inspiration in reference [4]*

# Appendix B

## Backward Selection Output

```{r backward-selection-appendix}
int_only_model <- glm(voted ~ 1,
                     data = elections_red,
                      family = "binomial")

full_model <- glm(voted ~ metro + sex + marst + veteran+ citizen + 
                   hispanic_status + employed + highest_education + 
                   current_student + race + AGE + Presidential_Election_Status
                 + YEAR,
                     data = elections_red,
                      family = "binomial")

best_model <- step(full_model, scope=formula(int_only_model), 
                   direction = "backward")

```

# Appendix C

## Checking Model Conditions for the resulting model from the selection process

### Linearity

```{r model-conditions-1-linearity}
elections_red %>%
  count(sex, voted) %>%
  group_by(sex) %>%
  mutate(prop = n/sum(n)) %>%
  filter(voted == "1") %>%
  mutate(emp_logit = log(prop/(1-prop))) %>% 
  kable(digits = 3, caption = "Empirical Logit Results For Sex")

elections_red %>%
  count(marst, voted) %>%
  group_by(marst) %>%
  mutate(prop = n/sum(n)) %>%
  filter(voted == "1") %>%
  mutate(emp_logit = log(prop/(1-prop))) %>% 
  kable(digits = 3, caption = "Empirical Logit Results For Marital Status")
```

```{r logit-appendix, fig.height=3, fig.width=5}
library(Stat2Data)
emplogitplot1(voted ~ AGE, data = elections_red, 
              ngroups = 10)
```

### Independence

**Misclassification rate by region**

```{r fip-new-appendix}
library(maps)
data(state.fips)
joined_fips <- left_join(elections_red, state.fips, by = c("STATEFIP" = "fips"))

model_aug <- augment(best_model, type.predict = "response") #probability

model_aug <- model_aug %>% 
  mutate(predicted_voted = if_else(.fitted > 0.5, "Will Vote", "Will Not Vote"))

tojoin <- joined_fips %>% 
  select(AGE, region)

aug_fips <- left_join(model_aug, tojoin, by ="AGE")
```

```{r misclassification-rates-by-region-appendix}
aug_fips <- aug_fips %>% 
  mutate(region = case_when(region == 1 ~ "Northeast",
                            region == 2 ~ "Midwest",
                            region == 3 ~ "South",
                            region == 4 ~ "West"))
# used Census data for the region fips number corresponding to region name [3]

missclassification <- aug_fips %>% 
  group_by(region) %>% 
  count(voted, predicted_voted) %>%  
  #all combs of responses specified as arguments
  mutate(prop = n / sum(n)) %>% 
  filter(voted == 1 & predicted_voted == "Will Not Vote" | 
        voted == 0 & predicted_voted == "Will Vote")
missclassification %>% 
  kable(digits = 3, caption = "Missclassification Rates by Region")
```

*Consulted Census data for the region fips number corresponding to region name [3]*

**Boxplot of misclassification rate by region**

```{r boxplot-misclassification-appendix, fig.height=3, fig.width=5}
aug_fips %>% 
  group_by(region) %>% 
  count(voted, predicted_voted) %>% 
  #all combs of responses specified as arguments
  ggplot(aes(x = predicted_voted, y = n, color = region)) +
  geom_boxplot()+
  labs(title = "Visualizing the Missclassification Rate by Region",
       x = "Voting Prediction Based on Model", 
       y = "Count")
```

## Checking for influential points

```{r obs-num-appendix}
best_aug <- augment(best_model) %>%
   mutate(obs_num = row_number()) #add row number to help with graphing
```

## Cook's distance plot

```{r Cooks-D-appendix, fig.height=3, fig.width=6}
## scatterplot of Cook's D vs. observation number
ggplot(data = best_aug, aes(x = obs_num, y = .cooksd)) +
  geom_point(alpha = 0.7) +
  geom_hline(yintercept = c(0.5,1), color = "red", lty = 2) +
  labs(x = "Observation Number", y = "Cook's D") +
  geom_text(aes(label = ifelse(.hat > 0.5,
                           as.character(obs_num), "")), nudge_x = 1)
```

**Multicollinearity: VIF Table**

```{r VIF-appendix}
# load rms package and calculate VIF
library(rms)
vif(best_model) %>% 
  tidy() %>% 
  arrange(x) %>% 
  kable(digits = 3)
```

# Appendix D

## Checking Model Conditions for the Final Model

### Checking for influential points

```{r obs-num-final-appendix}
final_best_aug <- augment(voting_model) %>%
   mutate(obs_num = row_number()) #add row number to help with graphing
```

**Cook's distance plot for final model**

```{r Cooks-final-appendix, fig.height=3, fig.width=6}
## scatterplot of Cook's D vs. observation number
ggplot(data = final_best_aug, aes(x = obs_num, y = .cooksd)) +
  geom_point(alpha = 0.7) +
  geom_hline(yintercept = c(0.5,1), color = "red", lty = 2) +
  labs(x = "Observation Number", y = "Cook's D") +
  geom_text(aes(label = ifelse(.hat > 0.5,
                           as.character(obs_num), "")), nudge_x = 1)
```

**Multicollinearity: VIF Table for final model**

```{r VIF-final-appendix}
# load rms package and calculate VIF
library(rms)
vif(voting_model) %>% 
  tidy() %>% 
  arrange(x) %>% 
  kable(digits = 3)
```
